<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Project-Oriented Coding</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dan Ovando" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Project-Oriented Coding
## SAFS OARS Learning Session
### Dan Ovando
### University of Washington
### 2020/4/5

---





# We Have a Problem

.center[
&lt;iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/zwRdO9_GGhY?start=694" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt;
]

---

# We Have a Problem

.center[
&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/zwRdO9_GGhY?start=2024" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt;
]

---


# Today's Content

.pull-left[

- Project Oriented Workflows

- Resilient paths

- Package dependencies

- R Markdown

- Scientific collaboration with git + github


].pull-right[

&lt;img src="https://journals.plos.org/plosbiology/article/figure/image?size=large&amp;id=10.1371/journal.pbio.3000763.g003" width="80%" /&gt;

]

---



class: center, inverse, middle



class: center, middle, inverse
# Science is all about reproducibility! 
# Why should it stop at our code?

???
Most of us trained in things like field methods: I've had way more classes in transect methods than coding practices.

Leads to methods that describe the brand of PVC pipe used but depend on a pile of code that will only work on the users computer for the week they submitted the paper, and never again

we put all this work into getting the data, and then drop the ball at the step that turns all that hard work into insight. 

As code becomes our primary tool, need to apply the same reprodicibility rigorous to our code that we're used to applying in our field methods
---


class: center, middle, inverse

# the point of all of this is to make your life easier

---

# [Project-Oriented Workflows](https://www.tidyverse.org/blog/2017/12/workflow-vs-script/)

&gt;This convention guarantees that the project can be moved around on your computer or onto other computers and will still ‚Äújust work‚Äù &lt;footer&gt;--- Jenny Bryan&lt;/footer&gt;

- All files needed to run your analysis in one folder
  - Nested subfolders as needed
  - **Does not have to be RStudio**

- All analysis written assuming
  - Fresh state
  - Working directory set to project directory
---

# Project-Oriented Workflows
see [Good Enough Practices in Scientific Computing](https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005510)
![https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005510](https://github.com/super-advanced-r-fall-2019/intro/raw/master/imgs/good-enough.png)

&amp; 
 
---

# Purge `setwd` from your scripts

&gt; *If the first line of your R script is*
  
&gt;  setwd("C:\Users\jenny\path\that\only\I\have")
  
&gt;  *I will come into your office and SET YOUR COMPUTER ON FIRE* üî•.
  
 &gt; *If the first line of your R script is*
  
&gt;  rm(list = ls())
  
&gt;  *I will come into your office and SET YOUR COMPUTER ON FIRE* üî•.
&lt;footer&gt;--- Jenny Bryan&lt;/footer&gt;
 

---


# What's wrong with `setwd`?

.pull-left[
### Workflow

*Personal decisions*

* Choice of IDE (RStudio, Sublime Text, scanning handwritten notes)

* CaMel or snake_case
  - But seriously, snake_case
  - See [tidyverse style guide](https://style.tidyverse.org/)

* Your lucky coding socks

* **Where the code lives**
]
.pull-right[

### Product

*What the analysis needs*

* The data

* Packages

* Package versions

* Custom functions

* Scripts  to tie it all together

]

---

## Alternatives to `setwd`

Using RStudio is a simple way around this
  
  - Create .Rproj file in the root directory of your project
  - I recommend ignoring these in your.gitignore file
  
Alternatively...
 
  - Often just open a file in the project directory with R GUI/Atom/Whatever
  
  - If that fails, use `cd` / `setwd` from the command line/console (not in your script) when you open your analysis
  
  - `here` will often do the job for you
  

Using project-oriented workflow means that once you're in the working directory, everything else should work


**It's the user's, not the code's, responsibility to make sure the working directory is set correctly** `\(^1\)`

.footnote[
[1] But do what works best for your workflow
]

---

# Exorcise the paths

OK, you've created a project oriented workflow

Is this OK now?

`my_data &lt;- read.csv("data\hake.csv")`

--
- Platform dependent

- Presents some problems for R Markdown


```r
getwd()
```

```
## [1] "/Users/danovan/projects/projects-with-github/presentations"
```

---


# File Paths with `here`

[`here`](https://github.com/jennybc/here_here) is a great little package for managing file paths
  - Basically file.path with a bit of sugar
  
  

```r
here::dr_here()
```

```
## here() starts at /Users/danovan/projects/projects-with-github.
## - This directory contains a file matching "[.]Rproj$" with contents matching "^Version: " in the first line
## - Initial working directory: /Users/danovan/projects/projects-with-github/presentations
## - Current working directory: /Users/danovan/projects/projects-with-github/presentations
```


`here` has a bunch of heuristics to figure out what the root of the project should be, and builds intelligent paths based on that


```r
here::here("data","hake.csv")
```

```
## [1] "/Users/danovan/projects/projects-with-github/data/hake.csv"
```

Looks for...
  - An RStudio project
  - a .git file
  - a .here file
  - etc.

---

# File Paths with `here`
Works on some machines...

```r

hake &lt;- read.csv("data\hake.csv")
```

```
## Error: '\h' is an unrecognized escape in character string starting ""data\h"
```

Works in the markdown but won't work in the command line

```r
hake &lt;- read.csv("../data/hake.csv")
```

Works on any platform and from anywhere in the project!

```r
hake &lt;- read.csv(here("data","hake.csv"))
```

What about this?


```r
hake &lt;- read.csv(here("home-folder","Place-With_Data","hake.csv"))
```

```
## Warning in file(file, "rt"): cannot open file '/Users/danovan/projects/projects-
## with-github/home-folder/Place-With_Data/hake.csv': No such file or directory
```

```
## Error in file(file, "rt"): cannot open the connection
```


---


# Git and GitHub are Great

.pull-left[

  - Make getting to the final product easier and safer
  - Allow others to easily use your results
  - Allows you to easily version your results
  
From a pure *reproducibility* perspective though, not strictly needed

- Could use email/dropbox/whatever to manage all your versions

- Publish the final reproducible code and results to say figshare without git/GitHub

So, we're not going to focus on git here today
  


].pull-right[

&lt;img src="http://swcarpentry.github.io/git-novice/fig/phd101212s.png" width="100%" /&gt;
]


---




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "dark",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
