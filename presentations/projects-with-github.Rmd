---
title: "Project-Oriented Coding "
subtitle: "SAFS OARS Learning Session"
author: "Dan Ovando"
institute: "University of Washington"
date: "2020/4/5"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: dark
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(here)
library(xaringan)
library(TMB)
library(tufte)
library(janitor)
library(dplyr)
library(ggplot2)
library(rstan)
library(sraplus)
library(bookdown)


```


# We Have a Problem

.center[
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/zwRdO9_GGhY?start=694" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
]

---

# We Have a Problem

.center[
<iframe width="560" height="315" src="https://www.youtube.com/embed/zwRdO9_GGhY?start=2024" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
]

---


# Today's Content

.pull-left[

- Project Oriented Workflows

- What is Git?

- What is GitHub?

- Using project-oriented workflows with GitHub


].pull-right[

```{r, echo = FALSE, out.width="80%"}
knitr::include_graphics("https://journals.plos.org/plosbiology/article/figure/image?size=large&id=10.1371/journal.pbio.3000763.g003")
```

]

---



class: center, inverse, middle



class: center, middle, inverse
# Science is all about reproducibility! 
# Why should it stop at our code?

???
Most of us trained in things like field methods: I've had way more classes in transect methods than coding practices.

Leads to methods that describe the brand of PVC pipe used but depend on a pile of code that will only work on the users computer for the week they submitted the paper, and never again

we put all this work into getting the data, and then drop the ball at the step that turns all that hard work into insight. 

As code becomes our primary tool, need to apply the same reprodicibility rigorous to our code that we're used to applying in our field methods
---


class: center, middle, inverse

# the point of all of this is to make your life easier

---


# Does This Look Familiar?

```{r, echo = FALSE}
knitr::include_graphics(here("presentations","imgs","oh-my.png"))
```


---

# Does This Look Familiar?

.pull-left[

- Multiple different projects in one folder
- No subfolder organization
- Stored in Google Drive
- Version control via file naming
- Manually modified data
- Results saved as .xlsx and manually versioned by name


].pull-right[

```{r, echo = FALSE}
knitr::include_graphics(here("presentations","imgs","oh-my.png"))

```

]

---

# What's Wrong With this?

.pull-left[

- Nothing if it's for your personal stuff!

- Version control via file naming is not stable
  - "ohhh, you used v5? Sorry the correct one is v2.3-FINAL
  - No connection between state of code that generated results and results
- No clear organization for other users to follow
- **Google Drive / whatever and Git/GitHub don't play nice together**


].pull-right[

```{r, echo = FALSE}
knitr::include_graphics(here("presentations","imgs","oh-my.png"))

```

]

---

# The Solution: [Project-Oriented Workflows](https://www.tidyverse.org/blog/2017/12/workflow-vs-script/)

>This convention guarantees that the project can be moved around on your computer or onto other computers and will still â€œjust workâ€ `r tufte::quote_footer('--- Jenny Bryan')`

- All files needed to run your analysis in one folder
  - Nested subfolders as needed
  - **Does not have to be RStudio**

- All analysis written assuming
  - Fresh state
  - Working directory set to project directory
---

# The Solution: Project-Oriented Workflows
see [Good Enough Practices in Scientific Computing](https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005510)
![https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005510](https://github.com/super-advanced-r-fall-2019/intro/raw/master/imgs/good-enough.png)

& 
 
---


# Project Oriented Workflow

```{r, echo = FALSE}
knitr::include_graphics(here("presentations","imgs","better.png"))

```

---

# Purge `setwd` from your scripts

> *If the first line of your R script is*
  
>  setwd("C:\Users\jenny\path\that\only\I\have")
  
>  *I will come into your office and SET YOUR COMPUTER ON FIRE* ðŸ”¥.
  
 > *If the first line of your R script is*
  
>  rm(list = ls())
  
>  *I will come into your office and SET YOUR COMPUTER ON FIRE* ðŸ”¥.
`r tufte::quote_footer('--- Jenny Bryan')`
 

---


# What's wrong with `setwd`?

.pull-left[
### Workflow

*Personal decisions*

* Choice of IDE (RStudio, Sublime Text, scanning handwritten notes)

* CaMel or snake_case
  - But seriously, snake_case
  - See [tidyverse style guide](https://style.tidyverse.org/)

* Your lucky coding socks

* **Where the code lives**
]
.pull-right[

### Product

*What the analysis needs*

* The data

* Packages

* Package versions

* Custom functions

* Scripts  to tie it all together

]

---

## Alternatives to `setwd`

Using RStudio is a simple way around this
  
  - Create .Rproj file in the root directory of your project
  - I recommend ignoring these in your.gitignore file
  
Alternatively...
 
  - Often just open a file in the project directory with R GUI/Atom/Whatever
  
  - If that fails, use `cd` / `setwd` from the command line/console (not in your script) when you open your analysis
  
  - `here` will often do the job for you
  

Using project-oriented workflow means that once you're in the working directory, everything else should work


**It's the user's, not the code's, responsibility to make sure the working directory is set correctly** $^1$

.footnote[
[1] But do what works best for your workflow
]

---

# Exorcise the paths

OK, you've created a project oriented workflow

Is this OK now?

`my_data <- read.csv("data\hake.csv")`

--
- Platform dependent

- Presents some problems for R Markdown

```{r}
getwd()
```

---


# File Paths with `here`

[`here`](https://github.com/jennybc/here_here) is a great little package for managing file paths
  - Basically file.path with a bit of sugar
  
  
```{r}
here::dr_here()
```


`here` has a bunch of heuristics to figure out what the root of the project should be, and builds intelligent paths based on that

```{r}
here::here("data","hake.csv")
```

Looks for...
  - An RStudio project
  - a .git file
  - a .here file
  - etc.

---

# File Paths with `here`
Works on some machines...
```{r, error=TRUE}

hake <- read.csv("data\hake.csv")

```

Works in the markdown but won't work in the command line
```{r}
hake <- read.csv("../data/hake.csv")
```

Works on any platform and from anywhere in the project!
```{r}
hake <- read.csv(here("data","hake.csv"))
```

What about this?

```{r, error = TRUE}
hake <- read.csv(here("home-folder","Place-With_Data","hake.csv"))
```


---

# Project Oriented Workflows

The Ideal: 

.center[*Any user should be able to reproduce the project on any computer with only the materials in the project folder, without changing any code*]


Obviously easier said than done, but this is what we're aiming for. 

Now we'll see how Git + GitHub can help make this happen

---


# Git and GitHub are Great

.pull-left[

- Provides a clear and consistent way to version your results

- Allow others to easily reproduce your results

- Enables efficient and safe collaboration

- Gives you a time machine for your results

But, at first glance it seems like a lot of work that couldbe done easier with Google Drive / email / track changes

We'll try and demystify it a bit today

**Git Materials largely drawn with permission from Lee Qi's excellent intro available [here](https://github.com/super-advanced-r-fall-2019/git-and-github) **
  


].pull-right[

```{r out.width = '100%', echo = FALSE}
knitr::include_graphics("http://swcarpentry.github.io/git-novice/fig/phd101212s.png") 
```
]


---

# What is Git?

Git is to GitHub what R is to RStudio


Git was originally developed by Linus Torvalds for development of the Linux kernel
  - Hence, interacting with Git only via the command line and the help files can feel... [confusing](https://git-man-page-generator.lokaltog.net/#Zml4JCRmaWxl)
  
Git is a software package for tracking changes in files in an organized way.  
  - Create snapshots of the code at specific moments in time via "commits"
  - Use commits to merge together different versions of the same code / resolve conflicts
  - Allow for development across multiple "branches" of a project
  - And lots of other fun stuff
  
  


---


# Why use version control?

```{r out.width = '50%'}
knitr::include_graphics("http://swcarpentry.github.io/git-novice/fig/phd101212s.png") 
```

---

.pull-left[
# Git

```{r out.width = '50%', echo = FALSE}
knitr::include_graphics("https://git-scm.com/images/logo@2x.png") 
```

1. Local version control

1. From the command line or used with third party GUIs

1. Self-contained records of code
]

.pull-right[
# GitHub

```{r out.width = '20%', echo = FALSE}
knitr::include_graphics("https://logos-download.com/wp-content/uploads/2016/09/GitHub_logo.png") 
```

1. Cloud-based hosting platform

1. Intuitive graphical web user interface

1. Designed for sharing and collaboration
]

---
## Why use

.pull-left[

```{r out.width = '50%', echo = FALSE}
# url
knitr::include_graphics("https://git-scm.com/images/logo@2x.png") 
```

Keep track of your code over time

Go back to older versions of your repository

Branch to develop and test new features
]
--

.pull-right[

```{r out.width = '20%', echo = FALSE}
knitr::include_graphics("https://logos-download.com/wp-content/uploads/2016/09/GitHub_logo.png") 
```

Store your repository with its associated version history in the cloud

Collaborate!
]

---

# Ways to Git

All Git commands can be executed in the command line- Command Prompt, Terminal.

There are also many different user interfaces for managing Git repositories.

- Dan's favourite: [GitKraken](https://www.gitkraken.com/)


- From the makers of Sublime Text: [SublimeMerge](https://www.sublimemerge.com/)


- From the developers of Github: [Github Desktop](https://desktop.github.com/)

- [RStudio](https://rstudio.com/)

.center[
```{r out.width = '15%'}
knitr::include_graphics("https://www.gitkraken.com/downloads/brand-assets/gitkraken-logo-light-sq.png")
```
```{r out.width = '15%'}
knitr::include_graphics("https://img.stackshare.io/service/9564/sublimemerge.png")
```
```{r out.width = '18%'}
knitr::include_graphics("https://desktop.github.com/images/desktop-icon.svg")
```
```{r out.width = '30%'}
knitr::include_graphics("https://rstudio.com/wp-content/uploads/2018/10/RStudio-Logo-Flat.png")
```
]

---

# The **BASICS** of Git

Goal here isn't to teach Git in one hour, just to familiarize you with the concepts so you can start / improve your journey

See 

[Happy Git and Github for the useR](https://happygitwithr.com/)

[Oh Sh*t, Git!](https://ohshitgit.com/) 
  
  * [Dangit, Git!](https://dangitgit.com/) if you're so inclined

[Oh My Git! (a Git learning game!)](https://blinry.itch.io/oh-my-git)

[git documentation itself isn't bad](https://git-scm.com/docs/)


---

# The **BASICS** of Git

Thankfully for most scientific collaboration across small-ish groups you usually don't need the complicated stuff

95% of my worflow uses variants of
- `commit`
- `pull`
- `push`
- `branch`
- `reset`

The rest of the stuff is there for when Sh*t hits the fan or for managing really complex projects

---

# `git commit -m`



---



